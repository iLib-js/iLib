

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> PhoneGeoLocator.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Namespaces</h3><ul><li><a href="CType.html">CType</a></li><li><a href="ilib.html">ilib</a></li></ul><h3>Classes</h3><ul><li><a href="Address.html">Address</a></li><li><a href="AddressFmt.html">AddressFmt</a></li><li><a href="AlphabeticIndex.html">AlphabeticIndex</a></li><li><a href="AreaUnit.html">AreaUnit</a></li><li><a href="CaseMapper.html">CaseMapper</a></li><li><a href="Charmap.html">Charmap</a></li><li><a href="CharmapTable.html">CharmapTable</a></li><li><a href="Charset.html">Charset</a></li><li><a href="Collator.html">Collator</a></li><li><a href="CopticCal.html">CopticCal</a></li><li><a href="CopticDate.html">CopticDate</a></li><li><a href="Country.html">Country</a></li><li><a href="Currency.html">Currency</a></li><li><a href="DateFmt.html">DateFmt</a></li><li><a href="DateRngFmt.html">DateRngFmt</a></li><li><a href="DigitalSpeedUnit.html">DigitalSpeedUnit</a></li><li><a href="DigitalStorageUnit.html">DigitalStorageUnit</a></li><li><a href="DurationFmt.html">DurationFmt</a></li><li><a href="EnergyUnit.html">EnergyUnit</a></li><li><a href="EthiopicCal.html">EthiopicCal</a></li><li><a href="EthiopicDate.html">EthiopicDate</a></li><li><a href="ForceUnit.html">ForceUnit</a></li><li><a href="FuelConsumptionUnit.html">FuelConsumptionUnit</a></li><li><a href="GlyphString.html">GlyphString</a></li><li><a href="GlyphString_charIterator-_chiterator.html">_chiterator</a></li><li><a href="GregorianCal.html">GregorianCal</a></li><li><a href="GregorianDate.html">GregorianDate</a></li><li><a href="HanCal.html">HanCal</a></li><li><a href="HanDate.html">HanDate</a></li><li><a href="HebrewCal.html">HebrewCal</a></li><li><a href="HebrewDate.html">HebrewDate</a></li><li><a href="INumber.html">INumber</a></li><li><a href="ISO2022.html">ISO2022</a></li><li><a href="ISet.html">ISet</a></li><li><a href="IString.html">IString</a></li><li><a href="IString_charIterator-_chiterator.html">_chiterator</a></li><li><a href="IString_iterator-_iterator.html">_iterator</a></li><li><a href="IslamicCal.html">IslamicCal</a></li><li><a href="IslamicDate.html">IslamicDate</a></li><li><a href="JulianCal.html">JulianCal</a></li><li><a href="JulianDate.html">JulianDate</a></li><li><a href="JulianDay.html">JulianDay</a></li><li><a href="LengthUnit.html">LengthUnit</a></li><li><a href="ListFmt.html">ListFmt</a></li><li><a href="Locale.html">Locale</a></li><li><a href="LocaleInfo.html">LocaleInfo</a></li><li><a href="LocaleMatcher.html">LocaleMatcher</a></li><li><a href="MassUnit.html">MassUnit</a></li><li><a href="Name.html">Name</a></li><li><a href="NameFmt.html">NameFmt</a></li><li><a href="NormString.html">NormString</a></li><li><a href="NormString_charIterator-_chiterator.html">_chiterator</a></li><li><a href="NumFmt.html">NumFmt</a></li><li><a href="PersianAlgoCal.html">PersianAlgoCal</a></li><li><a href="PersianAlgoDate.html">PersianAlgoDate</a></li><li><a href="PersianCal.html">PersianCal</a></li><li><a href="PersianDate.html">PersianDate</a></li><li><a href="PhoneFmt.html">PhoneFmt</a></li><li><a href="PhoneGeoLocator.html">PhoneGeoLocator</a></li><li><a href="PhoneNumber.html">PhoneNumber</a></li><li><a href="PowerUnit.html">PowerUnit</a></li><li><a href="PressureUnit.html">PressureUnit</a></li><li><a href="ResBundle.html">ResBundle</a></li><li><a href="ScriptInfo.html">ScriptInfo</a></li><li><a href="StringMapper.html">StringMapper</a></li><li><a href="TemperatureUnit.html">TemperatureUnit</a></li><li><a href="ThaiSolarCal.html">ThaiSolarCal</a></li><li><a href="ThaiSolarDate.html">ThaiSolarDate</a></li><li><a href="TimeUnit.html">TimeUnit</a></li><li><a href="TimeZone.html">TimeZone</a></li><li><a href="UTF16BE.html">UTF16BE</a></li><li><a href="UTF16LE.html">UTF16LE</a></li><li><a href="UTF8.html">UTF8</a></li><li><a href="UnitFmt.html">UnitFmt</a></li><li><a href="UnknownUnit.html">UnknownUnit</a></li><li><a href="VelocityUnit.html">VelocityUnit</a></li><li><a href="VolumeUnit.html">VolumeUnit</a></li></ul><h3>Interfaces</h3><ul><li><a href="ilib.Loader.html">Loader</a></li></ul><h3>Global</h3><ul><li><a href="global.html#CalendarFactory">CalendarFactory</a></li><li><a href="global.html#CharmapFactory">CharmapFactory</a></li><li><a href="global.html#DateFactory">DateFactory</a></li><li><a href="global.html#MeasurementFactory">MeasurementFactory</a></li><li><a href="global.html#isAlnum">isAlnum</a></li><li><a href="global.html#isAlpha">isAlpha</a></li><li><a href="global.html#isAscii">isAscii</a></li><li><a href="global.html#isBlank">isBlank</a></li><li><a href="global.html#isCntrl">isCntrl</a></li><li><a href="global.html#isDigit">isDigit</a></li><li><a href="global.html#isGraph">isGraph</a></li><li><a href="global.html#isIdeo">isIdeo</a></li><li><a href="global.html#isLower">isLower</a></li><li><a href="global.html#isPrint">isPrint</a></li><li><a href="global.html#isPunct">isPunct</a></li><li><a href="global.html#isScript">isScript</a></li><li><a href="global.html#isSpace">isSpace</a></li><li><a href="global.html#isUpper">isUpper</a></li><li><a href="global.html#isXdigit">isXdigit</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>PhoneGeoLocator.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * PhoneGeoLocator.js - Represent a phone number geolocator object.
 *
 * Copyright © 2014-2015, 2018, JEDLSoft
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

// !data iddarea area extarea extstates phoneres

var ilib = require("../index.js");
var Utils = require("./Utils.js");
var JSUtils = require("./JSUtils.js");

var PhoneNumber = require("./PhoneNumber.js");
var NumberingPlan = require("./NumberingPlan.js");
var PhoneLocale = require("./PhoneLocale.js");
var ResBundle = require("./ResBundle.js");

/**
 * @class
 * Create an instance that can geographically locate a phone number.&lt;p>
 *
 * The location of the number is calculated according to the following rules:
 *
 * &lt;ol>
 * &lt;li>If the areaCode property is undefined or empty, or if the number specifies a
 * country code for which we do not have information, then the area property may be
 * missing from the returned object. In this case, only the country object will be returned.
 *
 * &lt;li>If there is no area code, but there is a mobile prefix, service code, or emergency
 * code, then a fixed string indicating the type of number will be returned.
 *
 * &lt;li>The country object is filled out according to the countryCode property of the phone
 * number.
 *
 * &lt;li>If the phone number does not have an explicit country code, the MCC will be used if
 * it is available. The country code can be gleaned directly from the MCC. If the MCC
 * of the carrier to which the phone is currently connected is available, it should be
 * passed in so that local phone numbers will look correct.
 *
 * &lt;li>If the country's dialling plan mandates a fixed length for phone numbers, and a
 * particular number exceeds that length, then the area code will not be given on the
 * assumption that the number has problems in the first place and we cannot guess
 * correctly.
 * &lt;/ol>
 *
 * The returned area property varies in specificity according
 * to the locale. In North America, the area is no finer than large parts of states
 * or provinces. In Germany and the UK, the area can be as fine as small towns.&lt;p>
 *
 * If the number passed in is invalid, no geolocation will be performed. If the location
 * information about the country where the phone number is located is not available,
 * then the area information will be missing and only the country will be available.&lt;p>
 *
 * The options parameter can contain any one of the following properties:
 *
 * &lt;ul>
 * &lt;li>&lt;i>locale&lt;/i> The locale parameter is used to load translations of the names of regions and
 * areas if available. For example, if the locale property is given as "en-US" (English for USA),
 * but the phone number being geolocated is in Germany, then this class would return the the names
 * of the country (Germany) and region inside of Germany in English instead of German. That is, a
 * phone number in Munich and return the country "Germany" and the area code "Munich"
 * instead of "Deutschland" and "München". The default display locale is the current ilib locale.
 * If translations are not available, the region and area names are given in English, which should
 * always be available.
 * &lt;li>&lt;i>mcc&lt;/i> The mcc of the current mobile carrier, if known.
 *
 * &lt;li>&lt;i>onLoad&lt;/i> - a callback function to call when the data for the
 * locale is fully loaded. When the onLoad option is given, this object
 * will attempt to load any missing locale data using the ilib loader callback.
 * When the constructor is done (even if the data is already preassembled), the
 * onLoad function is called with the current instance as a parameter, so this
 * callback can be used with preassembled or dynamic loading or a mix of the two.
 *
 * &lt;li>&lt;i>sync&lt;/i> - tell whether to load any missing locale data synchronously or
 * asynchronously. If this option is given as "false", then the "onLoad"
 * callback must be given, as the instance returned from this constructor will
 * not be usable for a while.
 *
 * &lt;li>&lt;i>loadParams&lt;/i> - an object containing parameters to pass to the
 * loader callback function when locale data is missing. The parameters are not
 * interpretted or modified in any way. They are simply passed along. The object
 * may contain any property/value pairs as long as the calling code is in
 * agreement with the loader callback function as to what those parameters mean.
 * &lt;/ul>
 *
 * @constructor
 * @param {Object} options parameters controlling the geolocation of the phone number.
 */
var PhoneGeoLocator = function(options) {
    var sync = true,
        loadParams = {},
        locale = ilib.getLocale();

    if (options) {
        if (options.locale) {
            locale = options.locale;
        }

        if (typeof(options.sync) === 'boolean') {
            sync = options.sync;
        }

        if (options.loadParams) {
            loadParams = options.loadParams;
        }
    }

    new PhoneLocale({
        locale: locale,
        mcc: options &amp;&amp; options.mcc,
        countryCode: options &amp;&amp; options.countryCode,
        sync: sync,
        loadParams: loadParams,
        onLoad: ilib.bind(this, function (loc) {
            this.locale = loc;
            new NumberingPlan({
                locale: this.locale,
                sync: sync,
                loadParams: loadParams,
                onLoad: ilib.bind(this, function (plan) {
                    this.plan = plan;

                    new ResBundle({
                        locale: this.locale,
                        name: "phoneres",
                        sync: sync,
                        loadParams: loadParams,
                        onLoad: ilib.bind(this, function (rb) {
                            this.rb = rb;

                            Utils.loadData({
                                name: "iddarea.json",
                                object: "PhoneGeoLocator",
                                nonlocale: true,
                                sync: sync,
                                loadParams: loadParams,
                                callback: ilib.bind(this, function (data) {
                                    this.regiondata = data;
                                    Utils.loadData({
                                        name: "area.json",
                                        object: "PhoneGeoLocator",
                                        locale: this.locale,
                                        sync: sync,
                                        loadParams: JSUtils.merge(loadParams, {
                                            returnOne: true
                                        }),
                                        callback: ilib.bind(this, function (areadata) {
                                            this.areadata = areadata;

                                            if (options &amp;&amp; typeof(options.onLoad) === 'function') {
                                                options.onLoad(this);
                                            }
                                        })
                                    });
                                })
                            });
                        })
                    });
                })
            });
        })
    });
};

PhoneGeoLocator.prototype = {
    /**
     * Used for locales where the area code is very general, and you need to add in
     * the initial digits of the subscriber number in order to get the area
     * @private
     * @param {string} number
     * @param {Object} stateTable
     */
    _parseAreaAndSubscriber: function (number, stateTable) {
        var ch,
            i,
            handlerMethod,
            newState,
            consumed,
            lastLeaf,
            currentState,
            dot = 14;    // special transition which matches all characters. See AreaCodeTableMaker.java

        if (!number || !stateTable) {
            // can't parse anything
            return undefined;
        }

        //console.log("GeoLocator._parseAreaAndSubscriber: parsing number " + number);

        currentState = stateTable;
        i = 0;
        while (i &lt; number.length) {
            ch = PhoneNumber._getCharacterCode(number.charAt(i));
            if (ch >= 0) {
                // newState = stateData.states[state][ch];
                newState = currentState.s &amp;&amp; currentState.s[ch];

                if (!newState &amp;&amp; currentState.s &amp;&amp; currentState.s[dot]) {
                    newState = currentState.s[dot];
                }

                if (typeof(newState) === 'object') {
                    if (typeof(newState.l) !== 'undefined') {
                        // save for latter if needed
                        lastLeaf = newState;
                        consumed = i;
                    }
                    // console.info("recognized digit " + ch + " continuing...");
                    // recognized digit, so continue parsing
                    currentState = newState;
                    i++;
                } else {
                    if (typeof(newState) === 'undefined' || newState === 0) {
                        // this is possibly a look-ahead and it didn't work...
                        // so fall back to the last leaf and use that as the
                        // final state
                        newState = lastLeaf;
                        i = consumed;
                    }

                    if ((typeof(newState) === 'number' &amp;&amp; newState) ||
                        (typeof(newState) === 'object' &amp;&amp; typeof(newState.l) !== 'undefined')) {
                        // final state
                        var stateNumber = typeof(newState) === 'number' ? newState : newState.l;
                        handlerMethod = PhoneNumber._states[stateNumber];

                        //console.info("reached final state " + newState + " handler method is " + handlerMethod + " and i is " + i);

                        return (handlerMethod === "area") ? number.substring(0, i+1) : undefined;
                    } else {
                        // failed parse. Either no last leaf to fall back to, or there was an explicit
                        // zero in the table
                        break;
                    }
                }
            } else if (ch === -1) {
                // non-transition character, continue parsing in the same state
                i++;
            } else {
                // should not happen
                // console.info("skipping character " + ch);
                // not a digit, plus, pound, or star, so this is probably a formatting char. Skip it.
                i++;
            }
        }
        return undefined;
    },
    /**
     * @private
     * @param prefix
     * @param table
     */
    _matchPrefix: function(prefix, table)  {
        var i, matchedDot, matchesWithDots = [];

        if (table[prefix]) {
            return table[prefix];
        }
        for (var entry in table) {
            if (entry &amp;&amp; typeof(entry) === 'string') {
                i = 0;
                matchedDot = false;
                while (i &lt; entry.length &amp;&amp; (entry.charAt(i) === prefix.charAt(i) || entry.charAt(i) === '.')) {
                    if (entry.charAt(i) === '.') {
                        matchedDot = true;
                    }
                    i++;
                }
                if (i >= entry.length) {
                    if (matchedDot) {
                        matchesWithDots.push(entry);
                    } else {
                        return table[entry];
                    }
                }
            }
        }

        // match entries with dots last, so sort the matches so that the entry with the
        // most dots sorts last. The entry that ends up at the beginning of the list is
        // the best match because it has the fewest dots
        if (matchesWithDots.length > 0) {
            matchesWithDots.sort(function (left, right) {
                return (right &lt; left) ? -1 : ((left &lt; right) ? 1 : 0);
            });
            return table[matchesWithDots[0]];
        }

        return undefined;
    },
    /**
     * @private
     * @param number
     * @param data
     * @param locale
     * @param plan
     * @param options
     * @returns {Object}
     */
    _getAreaInfo: function(number, data, locale, plan, options) {
        var sync = true,
            ret = {},
            countryCode,
            areaInfo,
            temp,
            areaCode,
            geoTable,
            tempNumber,
            prefix;

        if (options &amp;&amp; typeof(options.sync) === 'boolean') {
            sync = options.sync;
        }

        prefix = number.areaCode || number.serviceCode;
        geoTable = data;

        if (prefix !== undefined) {
            if (plan.getExtendedAreaCode()) {
                // for countries where the area code is very general and large, and you need a few initial
                // digits of the subscriber number in order find the actual area
                tempNumber = prefix + number.subscriberNumber;
                tempNumber = tempNumber.replace(/[wWpPtT\+#\*]/g, '');    // fix for NOV-108200

                Utils.loadData({
                    name: "extarea.json",
                    object: "PhoneGeoLocator",
                    locale: locale,
                    sync: sync,
                    loadParams: JSUtils.merge((options &amp;&amp; options.loadParams) || {}, {returnOne: true}),
                    callback: ilib.bind(this, function (data) {
                        this.extarea = data;
                        Utils.loadData({
                            name: "extstates.json",
                            object: "PhoneGeoLocator",
                            locale: locale,
                            sync: sync,
                            loadParams: JSUtils.merge((options &amp;&amp; options.loadParams) || {}, {returnOne: true}),
                            callback: ilib.bind(this, function (data) {
                                this.extstates = data;
                                geoTable = this.extarea;
                                if (this.extarea &amp;&amp; this.extstates) {
                                    prefix = this._parseAreaAndSubscriber(tempNumber, this.extstates);
                                }

                                if (!prefix) {
                                    // not a recognized prefix, so now try the general table
                                    geoTable = this.areadata;
                                    prefix = number.areaCode || number.serviceCode;
                                }

                                if ((!plan.fieldLengths ||
                                  plan.getFieldLength('maxLocalLength') === undefined ||
                                  !number.subscriberNumber ||
                                     number.subscriberNumber.length &lt;= plan.fieldLengths('maxLocalLength'))) {
                                      areaInfo = this._matchPrefix(prefix, geoTable);
                                    if (areaInfo &amp;&amp; areaInfo.sn &amp;&amp; areaInfo.ln) {
                                        //console.log("Found areaInfo " + JSON.stringify(areaInfo));
                                        ret.area = {
                                            sn: this.rb.getString(areaInfo.sn).toString(),
                                            ln: this.rb.getString(areaInfo.ln).toString()
                                        };
                                    }
                                }
                            })
                        });
                    })
                });

            } else if (!plan ||
                    plan.getFieldLength('maxLocalLength') === undefined ||
                    !number.subscriberNumber ||
                    number.subscriberNumber.length &lt;= plan.getFieldLength('maxLocalLength')) {
                if (geoTable) {
                    areaCode = prefix.replace(/[wWpPtT\+#\*]/g, '');
                    areaInfo = this._matchPrefix(areaCode, geoTable);

                    if (areaInfo &amp;&amp; areaInfo.sn &amp;&amp; areaInfo.ln) {
                        ret.area = {
                            sn: this.rb.getString(areaInfo.sn).toString(),
                            ln: this.rb.getString(areaInfo.ln).toString()
                        };
                    } else if (number.serviceCode) {
                        ret.area = {
                            sn: this.rb.getString("Service Number").toString(),
                            ln: this.rb.getString("Service Number").toString()
                        };
                    }
                } else {
                    countryCode = number.locale._mapRegiontoCC(this.locale.getRegion());
                    if (countryCode !== "0" &amp;&amp; this.regiondata) {
                        temp = this.regiondata[countryCode];
                        if (temp &amp;&amp; temp.sn) {
                            ret.country = {
                                sn: this.rb.getString(temp.sn).toString(),
                                ln: this.rb.getString(temp.ln).toString(),
                                code: this.locale.getRegion()
                            };
                        }
                    }
                }
            } else {
                countryCode = number.locale._mapRegiontoCC(this.locale.getRegion());
                if (countryCode !== "0" &amp;&amp; this.regiondata) {
                    temp = this.regiondata[countryCode];
                    if (temp &amp;&amp; temp.sn) {
                        ret.country = {
                            sn: this.rb.getString(temp.sn).toString(),
                            ln: this.rb.getString(temp.ln).toString(),
                            code: this.locale.getRegion()
                        };
                    }
                }
            }

        } else if (number.mobilePrefix) {
            ret.area = {
                sn: this.rb.getString("Mobile Number").toString(),
                ln: this.rb.getString("Mobile Number").toString()
            };
        } else if (number.emergency) {
            ret.area = {
                sn: this.rb.getString("Emergency Services Number").toString(),
                ln: this.rb.getString("Emergency Services Number").toString()
            };
        }

        return ret;
    },
    /**
     * Returns a the location of the given phone number, if known.
     * The returned object has 2 properties, each of which has an sn (short name)
     * and an ln (long name) string. Additionally, the country code, if given,
     * includes the 2 letter ISO code for the recognized country.
     *         {
     *            "country": {
     *                "sn": "North America",
     *                "ln": "North America and the Caribbean Islands",
     *                "code": "us"
     *              },
     *              "area": {
     *               "sn": "California",
     *               "ln": "Central California: San Jose, Los Gatos, Milpitas, Sunnyvale, Cupertino, Gilroy"
     *              }
     *         }
     *
     * The location name is subject to the following rules:
     *
     * If the areaCode property is undefined or empty, or if the number specifies a
     * country code for which we do not have information, then the area property may be
     * missing from the returned object. In this case, only the country object will be returned.
     *
     * If there is no area code, but there is a mobile prefix, service code, or emergency
     * code, then a fixed string indicating the type of number will be returned.
     *
     * The country object is filled out according to the countryCode property of the phone
     * number.
     *
     * If the phone number does not have an explicit country code, the MCC will be used if
     * it is available. The country code can be gleaned directly from the MCC. If the MCC
     * of the carrier to which the phone is currently connected is available, it should be
     * passed in so that local phone numbers will look correct.
     *
     * If the country's dialling plan mandates a fixed length for phone numbers, and a
     * particular number exceeds that length, then the area code will not be given on the
     * assumption that the number has problems in the first place and we cannot guess
     * correctly.
     *
     * The returned area property varies in specificity according
     * to the locale. In North America, the area is no finer than large parts of states
     * or provinces. In Germany and the UK, the area can be as fine as small towns.
     *
     * The strings returned from this function are already localized to the
     * given locale, and thus are ready for display to the user.
     *
     * If the number passed in is invalid, an empty object is returned. If the location
     * information about the country where the phone number is located is not available,
     * then the area information will be missing and only the country will be returned.
     *
     * The options parameter can contain any one of the following properties:
      *
      * &lt;ul>
      * &lt;li>&lt;i>locale&lt;/i> The locale parameter is used to load translations of the names of regions and
      * areas if available. For example, if the locale property is given as "en-US" (English for USA),
      * but the phone number being geolocated is in Germany, then this class would return the the names
      * of the country (Germany) and region inside of Germany in English instead of German. That is, a
      * phone number in Munich and return the country "Germany" and the area code "Munich"
      * instead of "Deutschland" and "München". The default display locale is the current ilib locale.
      * If translations are not available, the region and area names are given in English, which should
      * always be available.
      * &lt;li>&lt;i>mcc&lt;/i> The mcc of the current mobile carrier, if known.
      *
      * &lt;li>&lt;i>onLoad&lt;/i> - a callback function to call when the data for the
      * locale is fully loaded. When the onLoad option is given, this object
      * will attempt to load any missing locale data using the ilib loader callback.
      * When the constructor is done (even if the data is already preassembled), the
      * onLoad function is called with the current instance as a parameter, so this
      * callback can be used with preassembled or dynamic loading or a mix of the two.
      *
      * &lt;li>&lt;i>sync&lt;/i> - tell whether to load any missing locale data synchronously or
      * asynchronously. If this option is given as "false", then the "onLoad"
      * callback must be given, as the instance returned from this constructor will
      * not be usable for a while.
      *
      * &lt;li>&lt;i>loadParams&lt;/i> - an object containing parameters to pass to the
      * loader callback function when locale data is missing. The parameters are not
      * interpretted or modified in any way. They are simply passed along. The object
      * may contain any property/value pairs as long as the calling code is in
      * agreement with the loader callback function as to what those parameters mean.
      * &lt;/ul>
     *
     * @param {PhoneNumber} number phone number to locate
     * @param {Object} options options governing the way this ares is loaded
     * @return {Object} an object
     * that describes the country and the area in that country corresponding to this
     * phone number. Each of the country and area contain a short name (sn) and long
     * name (ln) that describes the location.
     */
    locate: function(number, options) {
        var loadParams = {},
            ret = {},
            region,
            countryCode,
            temp,
            plan,
            areaResult,
            phoneLoc = this.locale,
            sync = true;

        if (number === undefined || typeof(number) !== 'object' || !(number instanceof PhoneNumber)) {
            return ret;
        }

        if (options) {
            if (typeof(options.sync) !== 'undefined') {
                sync = !!options.sync;
            }

            if (options.loadParams) {
                loadParams = options.loadParams;
            }
        }

        // console.log("GeoLocator.locate: looking for geo for number " + JSON.stringify(number));
        region = this.locale.getRegion();
        if (number.countryCode !== undefined &amp;&amp; this.regiondata) {
            countryCode = number.countryCode.replace(/[wWpPtT\+#\*]/g, '');
            temp = this.regiondata[countryCode];
            phoneLoc = number.destinationLocale;
            plan = number.destinationPlan;
            ret.country = {
                sn: this.rb.getString(temp.sn).toString(),
                ln: this.rb.getString(temp.ln).toString(),
                code: phoneLoc.getRegion()
            };
        }

        if (!plan) {
            plan = this.plan;
        }

        Utils.loadData({
            name: "area.json",
            object: "PhoneGeoLocator",
            locale: phoneLoc,
            sync: sync,
            loadParams: JSUtils.merge(loadParams, {
                returnOne: true
            }),
            callback: ilib.bind(this, function (areadata) {
                if (areadata) {
                    this.areadata = areadata;
                }
                areaResult = this._getAreaInfo(number, this.areadata, phoneLoc, plan, options);
                ret = JSUtils.merge(ret, areaResult);

                if (ret.country === undefined) {
                    countryCode = number.locale._mapRegiontoCC(region);

                    if (countryCode !== "0" &amp;&amp; this.regiondata) {
                        temp = this.regiondata[countryCode];
                        if (temp &amp;&amp; temp.sn) {
                            ret.country = {
                                sn: this.rb.getString(temp.sn).toString(),
                                ln: this.rb.getString(temp.ln).toString(),
                                code: this.locale.getRegion()
                            };
                        }
                    }
                }
            })
        });

        return ret;
    },

    /**
     * Returns a string that describes the ISO-3166-2 country code of the given phone
     * number.&lt;p>
     *
     * If the phone number is a local phone number and does not contain
     * any country information, this routine will return the region for the current
     * formatter instance.
     *
     * @param {PhoneNumber} number An PhoneNumber instance
     * @return {string}
     */
    country: function(number) {
        var countryCode,
            region,
            phoneLoc;

        if (!number || !(number instanceof PhoneNumber)) {
            return "";
        }

        phoneLoc = number.locale;

        region = (number.countryCode &amp;&amp; phoneLoc._mapCCtoRegion(number.countryCode)) ||
            (number.locale &amp;&amp; number.locale.region) ||
            phoneLoc.locale.getRegion() ||
            this.locale.getRegion();

        countryCode = number.countryCode || phoneLoc._mapRegiontoCC(region);

        if (number.areaCode) {
            region = phoneLoc._mapAreatoRegion(countryCode, number.areaCode);
        } else if (countryCode === "33" &amp;&amp; number.serviceCode) {
            // french departments are in the service code, not the area code
            region = phoneLoc._mapAreatoRegion(countryCode, number.serviceCode);
        }
        return region;
    }
};

module.exports = PhoneGeoLocator;
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.0</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
