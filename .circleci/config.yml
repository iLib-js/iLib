version: 2.1
jobs:
  test:
    docker:
      - image: cimg/openjdk:8.0-node
    steps:
      - checkout

      - run:
          name: Set up ant
          command: |
            sudo apt update
            sudo apt install -y ant

      - run:
          name: Set up QT
          command: |
            sudo apt-add-repository --yes ppa:beineri/opt-qt551-trusty
            sudo apt update
            sudo apt install -y 'qt55[QTPACKAGE]' qmlscene qt5-default qtdeclarative5-dev qtbase5-dev

      - run:
          name: Set up node packages
          command: |
            rm -rf node_modules package-lock.json
            npm install

      - run:
          name: Set up environment
          command: |
            export PATH=$PWD/node_modules/.bin:$PATH
            export NODE_OPTIONS="--max-old-space-size=3072"
            export TZ=America/Los_Angeles
            echo "node version: " $(node -v)
            echo "npm version: " $(npm -v)
            echo "java version: " $(java -version)
            echo "ant version: " $(ant -version)

      - run:
          name: Running all unit tests
          command: |
            ant clean test.travis

workflows:
  version: 2
  test-all-node-versions:
    jobs:
      - test
